Цель работы Получение практических навыков использования алгоритмов улучшения качества изображений, применяемых в пространственной области, на примерах методов шумоподавления, выделения контуров и градационных преобразований. Реализация модели аддитивного шума. При выполнении этого и последующих пунктов будет проводиться работа с яркостной составляющей изображения компонентой, значение в пикселе которой вычисляется по следующей формуле: где и значения цветовых компонент формата для соответствующего пикселя. Модель формирования аддитивного шума для битных значений интенсивностей пикселей изображения можно представить следующим образом: где значение шума на позиции пикселя с координатами х, у), а операция клиппирования, соответствующая следующей формуле: если если иначе Значение шума можно сгенерировать, воспользовавшись преобразованием Бокса-Мюллера: Пусть и независимые случайные величины, равномерно распределенные на интервале и и определены как тогда и независимы и имеют нормально распределение с математическим ожиданием и дисперсией Чтобы перейти к общему нормальному распределению воспользуемся формулой: где математическое ожидание, стандартное отклонение, а случайная величина с Гауссовским распределением Результаты формирования аддитивного шума: Рис. Изображение с шумом при Реализация модели импульсного шума. Модель формирования импульсного шума для битных значений интенсивностей описывается следующей формулой: с вероятностью с вероятностью с вероятностью где и параметры системы. Результаты формирования шума: Рис. Изображение с шумом при Как видно на изображениях импульсный шум более выражен чем аддитивный даже при небольшом значение вероятности, т.к. зашумлённые пиксели принимают крайние значения или Построение графиков для аддитивного и импульсного шумов. Необходимо построить графики и пиковое отношение сигнал-шум) соотношение между максимально возможным значением сигнала и мощности шума, искажающего значение сигнала. Значение вычисляется по следующей формуле: где исходное значение компоненты А по координатам значение компоненты А по этим же координатам в искаженном шумом изображении, и ширина и высота изображения соответственно, а количество бит, выделенных на значение компоненты. Рис. График при и Рис. График при По данным графикам видно какие искажения вносят импульсный и аддитивные шумы. Импульсный шум даже при малых параметрах сильно ухудшает качество картинки, т.к. максимальное значение чуть больше а, чтобы картинку можно было восстановилась, должен быть не меньше Обработка изображений с гауссовским шумом В процессе выполнения фильтрации входного зашумленного) изображения формируется новое изображение с теми же размерами. Каждый пиксель формируется в результате применения некоторого оператора к пикселю и подмножеству соседних с ним пикселей, образующих так называемую апертуру) фильтра. Применяемый оператор может быть как линейным, так и нелинейным. При линейной фильтрации используется следующее правило для расчета значений от фильтрованных пикселей: где радиус фильтра, определяющий апертуру, весовые коэффициенты фильтра, коэффициент нормировки, определяемый по формуле: Следует отметить, что использование термина радиус» является общепринятым, хотя в реальности апертура имеет форму квадрата со стороной На краях массива где апертура выходит за границы изображения, недостающее значение, как правило, заменяется интенсивностью ближайшего по Евклидову расстоянию пикселя. Реализация метода скользящего среднего В методе скользящего среднего значения весовых коэффициентов постоянны и не зависят от расстояния до центрального пикселя. Все весовые коэффициенты равны единице, в связи с этим выход фильтра рассчитывается последующей формуле: Результаты применения фильтра: Рис. Изображение с шумом при Рис. Отфильтрованное изображение при размере окна Как видно из приведенных рисунков отфильтрованное изображение получилось немного размытым, но шум удалось сгладить». Значение увеличилось с до Подборка оптимального размера окна Определим значение для и такое, что значение будет максимальным. Результаты работы программы: Реализация метода Гауссовской фильтрации Поскольку на фотореалистичном изображении соседние пиксели сильно коррелируют, значения весовых коэффициентов, как правило, рассчитываются на базе некоторой функции от расстояния до центральной позиции значения которой убывают по мере удаления позиции коэффициента от центральной. Однако такой подход имеет негативный эффект с точки зрения визуального восприятия. В окрестности контуров резких перепадов) применение линейных фильтров приводит к размытию» контура. Поэтому данный класс фильтров также называют фильтрами размытия. Функции расстояния для расчета значений весовых коэффициентов формируется на базе функции Гаусса от двух переменных отсюда и название фильтра): Где параметр фильтра, определяющий скорость убывания коэффициентов по мере удаления от позиции центрального пикселя. Результат применения фильтра: Рис. Изображение с шумом при Рис. Отфильтрованное изображение при размере окна и После фильтрации так же присутствует эффект размытия. Значения удалось увеличить с до за счет сглаживания» шума. Построение графиков Рис. График при Рис. График при Рис. График при Из полученных значениях параметр фильтра) значения при всех рассматриваемых шумах и значениях практически перестают меняться. Подбор оптимальных параметров Параметр шума: фильтра Параметр шума: фильтра Параметр шума: фильтра Параметр шума: фильтра Параметр шума: фильтра Как видно из полученных значений чем больше значение шума, тем больше значение при котором максимально. Метод медианной фильтрации Медианный фильтр является фильтром, основанным на порядковых статистиках частном случае нелинейной фильтрации. Алгоритм медианной фильтрации для пикселя можно представить в виде следующих шагов: Формирование одномерного массива из апертуры пикселя Взятие медианы одномерного массива Взятие медианы по массиву А происходит следующим образом: Производится сортировка элементов одномерного массива неважно по возрастанию или по убыванию) Сохранить в элемент, находящийся в середине отсортированного массива Для апертуры радиуса необходимо взять из отсортированного массива элемент с индексом Рис. Изображение с шумом при Рис. Отфильтрованное изображение с На выходе фильтра получено сильно размытое изображение. Шум на изображении удалось сгладить, контуры размыты. Значение увеличилось с до Визуально отфильтрованное изображение воспринимается сложнее, чем зашумленное. Подборка оптимального Определим значение для и такое, что значение будет максимальным: При зашумленности принимает максимальное значение при В случае большой зашумленности, когда наибольшее значение достигается при Отсюда можно сделать вывод, что чем сильнее шум на изображении, тем больший размер окна следует брать. Анализ после применения различных фильтров Сформируем изображения с различными аддитивными шумами при Проведем фильтрацию этого изображения различными фильтрами и проанализируем максимальные значение полученные в результате работы каждого фильтра. Для параметра шума Рис. Изображение с шумом. Рис. Изображение после фильтрации скользящего среднего. Рис. Изображение после фильтрации Гаусса. Рис. Изображение после медианной фильтрации. Для параметра шума Рис. Изображение с шумом. Рис. Изображение после фильтрации скользящего среднего. Рис. Изображение после фильтрации Гаусса. Рис. Изображение после медианной фильтрации. Для параметра шума Рис. Изображение с шумом. Рис. Изображение после фильтрации скользящего среднего. Рис. Изображение после фильтрации Гаусса. Рис. Изображение после медианной фильтрации. Для параметра шума Рис. Изображение с шумом. Рис. Изображение после фильтрации скользящего среднего. Рис. Изображение после фильтрации Гаусса. Рис. Изображение после медианной фильтрации. Для параметра шума Рис. Изображение с шумом. Рис. Изображение после фильтрации скользящего среднего. Рис. Изображение после фильтрации Гаусса. Рис. Изображение после медианной фильтрации. Визуально можно заметить, что метод Гаусса и скользящего среднего эффективнее улучшает изображение. Метод медианной фильтрации даже при слабом шуме заметно размывает изображение, соответственно, у метода медианной фильтрации практически отсутствует зернистость, как у фильтра Гаусса и скользящего среднего. Анализ после применения различных фильтров Построим графики зависимости для между исходным и зашумленным изображениями, а также максимальных между исходным и отфильтрованными изображениями для каждого фильтра Рис. Графики зависимости По графикам видно, что для слабозашумлённых изображений лучшей фильтрацией является фильтр Гаусса. Для все фильтры дают примерно одинаковый результат, однако визуально для медианного фильтра изображение воспринимается гораздо хуже. Обработка изображений с импульсным шумом. Наложение шума. Наложим на изображение импульсные шума так, чтобы доли искаженных пикселей составляли: и Рис. Изображение с шумом при Рис. Изображение с шумом при Рис. Изображение с шумом при Рис. Изображение с шумом при Вычисление по зашумленным изображениям Определим значения для изображений, сформированных в предыдущем пункте. Таблица. Результаты вычислений Применение медианной фильтрации Рис. Отфильтрованное изображение с шумом при и Рис. Изображение с шумом при и Рис. Изображение с шумом при и Рис. Изображение с шумом при и Анализ разных вариантов фильтрации Рис. График зависимости Из полученных графиков видно, что при низкой зашумленности и деформированных пикселей) наибольшие значения достигаются при размере окна При сильной зашумленности наибольшие значения достигаются при размере окон равных и соответственно. Реализация методов выделения контура Применение оператора Лапласа и формирование изображения по отклику Необходимо применить оператор Лапласа к изображению и получить отклик воспользовавшись формулой где в качестве весовых коэффициентов будут использоваться элементы масок: Результаты работы: Рис. Отклик после первой маски. Рис. Отклик после второй маски. По полученному отклику оператора Лапласа необходимо сформировать изображение. Значение пикселя на позиции х, у) вычисляется по следующей формуле: Полученный результат: Рис. Изображение после первой маски. Рис. Изображение после второй маски. По полученным изображениям можно увидеть разницу в применении масок. Например, после использования второй маски у решеток на окнах пропадает дополнительный контур. Синтез изображения с усилением высоких частот Необходимо синтезировать изображение с усилением высоких частот, используя разность исходного изображения и отклика оператора Лапласа применив маску. Значение пикселя на позиции х, у) синтезированного изображения вычисляется по следующей формуле: Полученный результат: Рис. Синтезированное изображение с усилением высоких частот. Рис. Синтезированное изображение после клиппирования. Изображение после клиппирования оказалось идентично изображению до, следовательно, значения пикселей не выходили за границы. Синтез изображений с различными значениями параметра Необходимо синтезировать изображения, применив маску для разных значений параметра Параметр изменяется в интервале от до с шагом Рис. Синтезированное изображение при Рис. Синтезированное изображение при Рис. Синтезированное изображение при Рис. Синтезированное изображение при Рис. Синтезированное изображение при Рис. Синтезированное изображение при По полученным изображениям можно сделать вывод, что, при увеличении общая яркость изображения увеличивается, а резкость уменьшается. Синтезированное изображение совпадает с при Так как именно при этом значении достигается максимальный эффект увеличения резкости. При увеличении значения растет яркость изображения. Средние значения яркости Необходимо рассчитать среднее значение яркости для каждого из изображений, полученных в предыдущем пункте. Таблица. Результаты вычислений средняя яркость Построение и анализ гистограмм Необходимо построить и проанализировать гистограммы для исходного изображения, а также изображений, полученных в результате выполнения пункта Результаты построения: Рис. Гистограмма исходного изображения. Рис. Гистограмма изображения при Рис. Гистограмма изображения при Рис. Гистограмма изображения при Рис. Гистограмма изображения при Рис. Гистограмма изображения при По полученным гистограммам отчетливо можно видеть, что, при увеличении уменьшается общее количество пикселей с интенсивностью компоненты и увеличивается крайний правый пик количество пикселей с интенсивностью компоненты равной Это связано с постепенным осветлением изображения все больше компонент пикселей принимают свое максимальное значение. Реализация оператора Собеля Необходимо применить оператор Собеля к исходному изображению Оператор Собеля является ключевым во многих алгоритмах анализа контуров изображения. В основе оператора Собеля лежит расчет двух производных: по вертикали и по горизонтали. Соответствующие этим операциям маски фильтров приведены на рис. Рис. Маски фильтров, используемые в операторе Собеля: а) по горизонтали, б) по вертикали. Алгоритм применения оператора: Рассчитать значения откликов и используя фильтры с масками, показанными на рис. Рассчитать величину силы длины) контура по формуле Рассчитать направление градиента по формуле Результат: Рис. Результат применения оператора Собеля. Формирование изображений с различными порогами Рис. Результат применения оператора Собеля при Рис. Результат применения оператора Собеля при Рис. Результат применения оператора Собеля при Рис. Результат применения оператора Собеля при Рис. Результат применения оператора Собеля при Рис. Результат применения оператора Собеля при По сформированным изображениям можно сделать вывод, что наиболее точной бинарной картой является карта с порогом В случае, когда изображения перегружены черными пикселями. При пороге некоторые контуры становятся чётче различимы, а некоторые исчезают вовсе. Карта направлений градиентов Необходимо построить цветную карту направлений градиентов на полученных изображениях по такому правилу: Результат Рис. Карта направлений градиентов. Реализация градационных преобразований Назовем множество пикселей, формирующих изображение, пространственной областью. Пространственные методы повышения качества изображений оперируют непосредственно значениями этих пикселей и могут описываться следующим выражением: где входные данные, обработанные данные и оператор над определенный в некоторой окрестности точки с координатами х, у). В простейшем случае функция отображения не зависит от местоположения обрабатываемого пикселя и неизменна для всего изображения. Градационное преобразование можно представить в виде черного” ящика с отсутствующей памятью, который для конкретного входного значения формирует соответствующее выходное на основе заранее определенной функции. Синтез засвеченного, затемненного и сбалансированного изображений Рис. Сбалансированное изображение. Рис. Синтезированное засвеченное изображение. Рис. Синтезированное затемненное изображение. Преобразование методом на основе опорных точек К полученным в предыдущем пункте изображениям нужно применить градационное преобразование на базе двух опорных точек для повышения их качества. Метод опорных точек один из простейших методов улучшения качества изображения на основе анализа и видоизменения гистограммы основывается на использовании метода опорных точек. На основе точек и и двух опорных точек, которые задаёт человек, входное значение преобразуется с помощью линейной интерполяции в новое значение. Рис. Сбалансированное изображение, Сбалансированное изображение на основе опорных точек и Рис. Затемненное изображение. Рис. Затемненное изображение на основе опорных точек и Рис. Осветленное изображение. Рис. Осветленное изображение на основе опорных точек и Формирование гистограмм Необходимо сформировать и проанализировать гистограммы для исходных и полученных изображений из предыдущего пункта. Рис. Гистограмма сбалансированного изображения. Рис. Гистограмма сбалансированного изображения на опорных точках. Рис. Гистограмма засвеченного изображения. Рис. Гистограмма засвеченного изображения на опорных точках. Рис. Гистограмма затемненного изображения. Рис. Гистограмма затемненного изображения на опорных точках. По полученным гистограммам можно увидеть, что преобразование практически не влияет на количество пикселей с крайними значениями компонент относительно других пикселей, но поднимает количество отдаленных от крайних пикселей. Гамма преобразования Необходимо получить графики уравнения для различных значений параметра для каждого из трех входных изображений. Степенные преобразования выполняются по следующей формуле: где и являются положительными величинами. При этом перед выполнением расчета по формуле входное значение следует привести в диапазон Выходное значение возвращают в диапазон путем умножения на Результат: Рис. Сбалансированное изображение. Рис. Сбалансированное изображение при Рис. Сбалансированное изображение при Рис. Сбалансированное изображение при Рис. Сбалансированное изображение при Рис. Сбалансированное изображение при Рис. Затемненное изображение. Рис. Затемненное изображение при Рис. Затемненное изображение при Рис. Затемненное изображение при Рис. Затемненное изображение при Рис. Затемненное изображение при Рис. Осветленное изображение. Рис. Осветленное изображение при Рис. Осветленное изображение при Рис. Осветленное изображение при Рис. Осветленное изображение при Рис. Осветленное изображение при По полученным гистограммам можно сделать вывод, что при значениях яркость изображения увеличивается. А при наоборот уменьшается. Формирование гистограмм Рис. Гистограмма сбалансированного изображения. Рис. Гистограмма сбалансированного изображения при Рис. Гистограмма сбалансированного изображения при Рис. Гистограмма сбалансированного изображения при Рис. Гистограмма сбалансированного изображения при Рис. Гистограмма сбалансированного изображения при Рис. Гистограмма затемненного изображения. Рис. Гистограмма затемненного изображения при Рис. Гистограмма затемненного изображения при Рис. Гистограмма затемненного изображения при Рис. Гистограмма затемненного изображения при Рис. Гистограмма затемненного изображения при Рис. Гистограмма осветленного изображения. Рис. Гистограмма осветленного изображения при Рис. Гистограмма осветленного изображения при Рис. Гистограмма осветленного изображения при Рис. Гистограмма осветленного изображения при Рис. Гистограмма осветленного изображения при По полученным данным можно убедиться, что вывод, сделанный в предыдущем пункте, верный. Методы выравнивания гистограмм Выравнивание гистограммы может быть использовано в задаче улучшения качества изображений. Данный подход может увеличить контрастность обрабатываемого изображения. Для выполнения операции выравнивания гистограмм следует воспользоваться формулой на базе эмпирической функции распределения: где максимально допустимое число градаций интенсивности на изображении, значение интенсивности в выходном изображении, в которое будет преобразовываться общее число пикселей и число пикселей, имеющих яркость Необходимо синтезировать засвеченное, затемненное, а также сбалансированное изображения и применить к ним алгоритм выравнивания гистограмм в соответствии с формулой. Рис. Исходное сбалансированное изображение. Рис. Обработанное сбалансированное изображение. Рис. Исходное затемненное изображение. Рис. Обработанное затемненное изображение. Рис. Исходное осветленное изображение. Рис. Обработанное осветленное изображение. Формирование гистограмм Рис. Гистограмма сбалансированного изображения. Рис. Гистограмма обработанного сбалансированного изображения. Рис. Гистограмма затемненного изображения. Рис. Гистограмма обработанного затемненного изображения. Рис. Гистограмма осветленного изображения. Рис. Гистограмма обработанного осветленного изображения. По полученным данным видно, что все пиксели выравниваются, образуя равномерное распределение. Визуально видно, что после обработки осветленного и затемнённого изображений, они стали ближе к сбалансированному. Методы построения карты контуров на основе градационных преобразований. Метод построение карты контуров заключается в следующем: в зависимости от выбора порога выходной пиксель бинарного значения соответствует белому интенсивность соответствующего пикселя исходного изображения превышает порог) или черному цвету иначе). Необходимо синтезировать градационную функцию преобразования для построения бинарного изображения. Порог принадлежит интервалу и изменяется с фиксированным шагом. Рис. Исходное изображение. Рис. Бинарное изображение при Рис. Бинарное изображение при Рис. Бинарное изображение при Рис. Бинарное изображение при Рис. Бинарное изображение при Рис. Бинарное изображение при Рис. Бинарное изображение при Рис. Бинарное изображение при Рис. Бинарное изображение при Рис. Бинарное изображение при Рис. Бинарное изображение при Формирование наглядного бинарного изображения Рис. Бинарное изображение при Изображение, полученное при Т получилось наиболее наглядным, т.к. достаточно хорошо видны мелкие детали, при этом общий контур изображения так же хорошо различим. Отсюда можно сделать вывод, что значение находящееся приблизительно в середине диапазона для сбалансированного изображения является лучшим. Значения гораздо выше середины являются в данном случае худшими, т.к. на изображении просто белое. Значения гораздо больше среднего с увеличением порога теряют точность, однако разобрать возможно. Выводы В ходе выполнение лабораторной работы было установлено: Импульсный шум намного больше, чем аддитивный, ухудшает качество изображения, поскольку пиксели принимают крайние значения или Для аддитивного шума, при малом количестве шума, лучшим фильтром оказался фильтр Гаусса. При большом количестве шума после применения любого фильтра у изображения нельзя различить основные детали. С импульсным шумом практически идеально справляется медианный фильтр. Он полностью убирает шум при небольшом его количестве, а при большом количестве шума на изображении можно разглядеть основные детали. Оператор Лапласа увеличивает яркость изображения при увеличении При яркость не меняется, но контуры становятся более четкими. Оператор Собеля наиболее точную бинарную карту дает при пороге В случае, когда изображения перегружены черными пикселями. При пороге некоторые контуры становятся чётче различимы, а некоторые исчезают вовсе. Методы на основе опорных точек и гамма-преобразования позволяют менять оттенки серого. Метод выравнивания гистограмм для засвеченного и затемнённого изображений приближают картинки к сбалансированному и выравнивают значения пикселей по всему диапазону. Наиболее точная карта контуров получается при значении порога видны мелкие детали, а общий контур изображения ещё хорошо различим. Листинг программы Первая часть Аддитивный шум Импульсный шум Графики пункт') Для сигмы равной Для Ра Рв Аддитивный шум') Импульсный шум') Скользящее среднее пункт') для кользящего среднего Подбор размера окна пункт') для сигмы Максимальное Максимальный номер окна Сигма Гауссовская фильтрация пункт') Графики для Гаусса сигма фильтра') сигма сигма сигма сигма сигма Медианный фильтр Подбор размера окна пункт') для сигмы Максимальное Максимальный номер окна Медианный фильтр') сигма сигма сигма сигма сигма Сигма') от сигмы шума') Изображение с шумом', Скользящее среднее', Гауссовский фильтр', Медианный фильтр') Шум Шум Шум Шум Вторая часть редняя яркость: редняя яркость редняя яркость редняя яркость редняя яркость редняя яркость(alpha редняя яркость горизонталь вертикаль Третья часть Сбалансиованное изображение') Затемненное изображение') Засвеченное иозбражение') Засвеченное иозбражение после преобразования') Затемненное изображение после преобразования') Сбалансиованное изображение после преобразования') гамма Засвеченное изображение, выравнивание гистограмм Сбалансированное изображение') Затемненное изображение') Засвеченное изображение') карта контуров Входное значение') Выходное значение') 