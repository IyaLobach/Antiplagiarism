2 1. ФОРМУЛИРОВКА ЗАДАНИЯ 1. В базовом примере заменить фрагмент кода, выделенный зелёным, на фрагмент из своего варианта, создать новый проект в Atmel Studio и сформировать исполняемый код (файл «.hex»), проверить работу данного кода на МК. 2. Определить зависимость количества тактов, за которое выполняется заменённый блок кода, от констант x, y, и z. 3. Вычислить значения констант x, y и z, при которых блок кода «delay» будет выполняться ровно 1 секунду (при тактовой частоте 8 МГц). При невозможности обеспечения точной величины задержки необходимо дополнить блок кода соответствующим количеством команд NOP (на месте закомментированной команды NOP в базовом примере). 2. СХЕМА ЛАБОРАТОРНОЙ УСТАНОВКИ  Рисунок 1 — Схема лабораторной установки. 3 3. БЛОК-СХЕМА АЛГОРИТМА РАБОТЫ ПРОГРАММЫ  Рисунок 2 — Блок-схема алгоритма. 4. ВРЕМЕННЫЕ ДИАГРАММЫ ЛОГИЧЕСКИХ СИГНАЛОВ НА ПОРТАХ МК (ФРАГМЕНТ)  Рисунок 3 — Временные диаграммы логических сигналов на портах МК. 4 5. АЛГОРИТМ ВЫПОЛНЕНИЯ ЗАДЕЙСТВОВАННЫХ КОМАНД (КОНСТРУКЦИЙ) АССЕМБЛЕРА 1) В блоке start настраивается порт А. 2) В блоке delay присваиваются значения регистрам. 3) В блоке delay_sub выполняются внешний и внутренний циклы. Во внутреннем цикле из регистровой пары R25:R24 вычитается единица, после, если результат не равен 0, то выполняется переход в начало цикла, и данный цикл выполняется до тех пор, пока результат не будет равен 0. Во внешнем цикле, после того как получен 0 во внутреннем цикле, из R16 вычитается единица, и если результат не 0, то выполняется переход на начало цикла, цикл выполняется до тех пор, пока R16 не будет равно 0. 4) Возврат на start и повторение. 6. РЕЗУЛЬТАТЫ РАБОТЫ Было рассчитано время работы каждого блока, исходя из времени выполнения каждой инструкции. start:      SER R20 ; 1     OUT DDRA,R20 ; 1     IN R21,PORTA ; 1     COM R21  ; 1     OUT PORTA, R21  ; 1  delay:      LDI R16, 10; 1     LDI R25, 150; 1      LDI R24, 50; 1  delay_sub:      nop ;1     SBIW R24, 1  ; 2     BRNE delay_sub ; 1/2     DEC R16 ; 1     BRNE delay_sub ; 1/2     rjmp start ; 2  start: 5 тактов delay: 3 такта delay_sub: N_1 = (x << 8 + y -1) * 5 + 4 N_2 = (2^16-1)*5 + 7 N_3 = N_2*(z-1) + 8 N_1 + N_3 = 8000000  Далее, с помощью программы, ищем решение следующего уравнения методом перебора: (x << 8 + y -1) *5 + 4 + ((2^16-1)*5 + 7)*(z-1) + 8 = 8 000 000  Получаем: x=105 y=245 z=25  5 7. ОТВЕТЫ НА КОНТРОЛЬНЫЕ ВОПРОСЫ 1. Из каких основных узлов состоит микроконтроллер ATmega32? Сумматоры, счетчики, регистры, мультиплексоры, дешифраторы, АЦП, ЦАП.  2. Перечислите признаки RISC-архитектуры в микроконтроллер ATmega32. 32 рабочих регистра общего назначения; 131 команда; полностью статический режим работы; производительность до 16 MIPS при 16 МГц. 3. Выполните сравнение гарвардской и фон-неймановской архитектуры процессоров. В фон-неймановской архитектуре, в отличие от гарвардской, команды и данные хранятся вместе (образуют единое пространство памяти). Гарвардская архитектура применяется в микроконтроллерах и в сигнальных процессорах. Почти все современные ЭВМ построены на фон-неймановской архитектуре.  4. Опишите алгоритм выполнения команд ICALL, ADIW и LDD для микроконтроллера ATmega32. ICALL — вызов подпрограммы, осуществляемый по адресу в регистре Z (R30:R31) ADIW — сложение константы (0-63) с регистровой парой и размещение результата в регистровой паре. LDD — выполняется косвенно-регистровое считывание из ОЗУ со смещением Rd ← (Y   + q).   5. От чего зависит время выполнения команд BRPL и CPSE? Время выполнения команд условного перехода зависит от того, происходит или не происходит переход. BRPL: переход, если положительно (N=0). Если положительно, то операция займет время выполнения 2 такта, если отрицательно, то 1 такт.  CPSE: выполняет сравнение содержимого двух регистров и пропускает следующую команду, если они равны. То есть, в случае равенства – 1 такт, в противном случае – 2.  8. ВЫВОДЫ ПО ЛАБОРАТОРНОЙ РАБОТЕ В ходе выполнения данной лабораторной работы были изучены основы работы с AtmelStudio, и с микроконтроллером ATmega32. Был изучен алгоритм расчета времени работы программы.   6 ПРИЛОЖЕНИЕ 1 КОММЕНТИРОВАННЫЙ ЛИСТИНГ ПРОГРАММЫ ДЛЯ МК НА ЯЗЫКЕ АССЕМБЛЕРА start:      SER R20 ; 1     OUT DDRA,R20 ; 1     IN R21,PORTA ; 1     COM R21  ; 1     OUT PORTA, R21  ; 1  delay:      LDI R16, 10; 1     LDI R25, 150; 1      LDI R24, 50; 1  delay_sub:      nop ;1     SBIW R24, 1  ; 2     BRNE delay_sub ; 1/2     DEC R16 ; 1     BRNE delay_sub ; 1/2     rjmp start ; 2 